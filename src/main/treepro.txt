PROJECT STRUCTURE :
main
├── .DS_Store
├── java/
│   ├── .DS_Store
│   └── it/
│       ├── .DS_Store
│       └── uniroma3/
│           ├── .DS_Store
│           └── siwbooks/
│               ├── SiwbooksApplication.java
│               ├── authentication/
│               │   ├── AuthConfiguration.java
│               │   └── SecurityBeansConfig.java
│               ├── constant/
│               │   └── Nationality.java
│               ├── controller/
│               │   ├── AdminAuthorController.java
│               │   ├── AdminBookController.java
│               │   ├── AuthorController.java
│               │   ├── BookController.java
│               │   ├── HomeController.java
│               │   ├── LoginController.java
│               │   ├── RegisterController.java
│               │   ├── ReviewController.java
│               │   └── UserController.java
│               ├── model/
│               │   ├── Author.java
│               │   ├── Book.java
│               │   ├── Credentials.java
│               │   ├── ImageEntity.java
│               │   ├── Review.java
│               │   └── User.java
│               ├── repository/
│               │   ├── AuthorRepository.java
│               │   ├── BookRepository.java
│               │   ├── CredentialsRepository.java
│               │   ├── ImageEntityRepository.java
│               │   ├── ReviewRepository.java
│               │   └── UserRepository.java
│               └── service/
│                   ├── AuthorService.java
│                   ├── BookService.java
│                   ├── CredentialsService.java
│                   ├── ImageEntityService.java
│                   ├── ReviewService.java
│                   └── UserService.java
├── resources/
│   ├── application.properties
│   ├── import.sql
│   ├── static/
│   │   ├── css/
│   │   │   ├── author.css
│   │   │   ├── authors.css
│   │   │   ├── book.css
│   │   │   ├── books.css
│   │   │   ├── layout.css
│   │   │   ├── login.css
│   │   │   ├── profile.css
│   │   │   └── register.css
│   │   └── images/
│   │       ├── Amore_Ai_Tempi_1.jpg
│   │       ├── Amore_Ai_Tempi_2.jpg
│   │       ├── Cent_Anni_1.jpg
│   │       ├── Cent_Anni_2.jpg
│   │       ├── Gabriel_Garcia_Marquez.jpg
│   │       ├── Jane_Austen_coloured_version.jpg
│   │       ├── Orgoglio_E_Pregiudizio_1.jpg
│   │       ├── Orgoglio_E_Pregiudizio_2.jpg
│   │       ├── Ragione_E_Sentimento_1.jpg
│   │       ├── Ragione_E_Sentimento_2.jpg
│   │       └── placeholder.jpg
│   └── templates/
│       ├── admin/
│       │   ├── author.html
│       │   ├── authors.html
│       │   ├── book.html
│       │   ├── books.html
│       │   └── profile.html
│       ├── admin_book_form.html
│       ├── author.html
│       ├── authors.html
│       ├── book.html
│       ├── books.html
│       ├── error.html
│       ├── login.html
│       ├── register.html
│       ├── review_edit.html
│       └── user/
│           ├── author.html
│           ├── authors.html
│           ├── book.html
│           ├── books.html
│           └── profile.html
└── treepro.txt


SELECTED FILES:
- java/it/uniroma3/siwbooks/SiwbooksApplication.java
- java/it/uniroma3/siwbooks/authentication/AuthConfiguration.java
- java/it/uniroma3/siwbooks/authentication/SecurityBeansConfig.java
- java/it/uniroma3/siwbooks/constant/Nationality.java
- java/it/uniroma3/siwbooks/controller/AdminAuthorController.java
- java/it/uniroma3/siwbooks/controller/AdminBookController.java
- java/it/uniroma3/siwbooks/controller/AuthorController.java
- java/it/uniroma3/siwbooks/controller/BookController.java
- java/it/uniroma3/siwbooks/controller/HomeController.java
- java/it/uniroma3/siwbooks/controller/LoginController.java
- java/it/uniroma3/siwbooks/controller/RegisterController.java
- java/it/uniroma3/siwbooks/controller/ReviewController.java
- java/it/uniroma3/siwbooks/controller/UserController.java
- java/it/uniroma3/siwbooks/model/Author.java
- java/it/uniroma3/siwbooks/model/Book.java
- java/it/uniroma3/siwbooks/model/Credentials.java
- java/it/uniroma3/siwbooks/model/ImageEntity.java
- java/it/uniroma3/siwbooks/model/Review.java
- java/it/uniroma3/siwbooks/model/User.java
- java/it/uniroma3/siwbooks/repository/AuthorRepository.java
- java/it/uniroma3/siwbooks/repository/BookRepository.java
- java/it/uniroma3/siwbooks/repository/CredentialsRepository.java
- java/it/uniroma3/siwbooks/repository/ImageEntityRepository.java
- java/it/uniroma3/siwbooks/repository/ReviewRepository.java
- java/it/uniroma3/siwbooks/repository/UserRepository.java
- java/it/uniroma3/siwbooks/service/AuthorService.java
- java/it/uniroma3/siwbooks/service/BookService.java
- java/it/uniroma3/siwbooks/service/CredentialsService.java
- java/it/uniroma3/siwbooks/service/ImageEntityService.java
- java/it/uniroma3/siwbooks/service/ReviewService.java
- java/it/uniroma3/siwbooks/service/UserService.java
- resources/templates/admin/author.html
- resources/templates/admin/authors.html
- resources/templates/admin/book.html
- resources/templates/admin/books.html
- resources/templates/admin/profile.html
- resources/templates/admin_book_form.html
- resources/templates/author.html
- resources/templates/authors.html
- resources/templates/book.html
- resources/templates/books.html
- resources/templates/error.html
- resources/templates/login.html
- resources/templates/register.html
- resources/templates/review_edit.html
- resources/templates/user/author.html
- resources/templates/user/authors.html
- resources/templates/user/book.html
- resources/templates/user/books.html
- resources/templates/user/profile.html
- treepro.txt

CONTENT OF SELECTED FILES:

--- java/it/uniroma3/siwbooks/SiwbooksApplication.java ---
package it.uniroma3.siwbooks;

import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class SiwbooksApplication {

	public static void main(String[] args) {
		SpringApplication.run(SiwbooksApplication.class, args);
	}

}


--- java/it/uniroma3/siwbooks/authentication/AuthConfiguration.java ---
package it.uniroma3.siwbooks.authentication;

import static it.uniroma3.siwbooks.model.Credentials.ADMIN_ROLE;
import static it.uniroma3.siwbooks.model.Credentials.DEFAULT_ROLE;

import javax.sql.DataSource;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.http.HttpMethod;
import static org.springframework.security.config.Customizer.withDefaults;
import org.springframework.security.config.annotation.web.builders.HttpSecurity;
import org.springframework.security.config.annotation.web.configuration.EnableWebSecurity;
import org.springframework.security.web.SecurityFilterChain;
import it.uniroma3.siwbooks.service.CredentialsService;

import org.springframework.security.config.annotation.authentication.builders.AuthenticationManagerBuilder;

@Configuration
@EnableWebSecurity
public class AuthConfiguration {
	
	@Autowired
	private DataSource dataSource;
	
	@Autowired
	private CredentialsService credentialsService;

	@Autowired
	public void configureGlobal(AuthenticationManagerBuilder auth) throws Exception {
		auth.jdbcAuthentication().dataSource(dataSource)
				.authoritiesByUsernameQuery("SELECT username, role from credentials WHERE username=?")
				.usersByUsernameQuery("SELECT username, password, 1 as enabled FROM credentials WHERE username=?");
	}


	@Bean
	protected SecurityFilterChain configure(final HttpSecurity httpSecurity) throws Exception {
        httpSecurity.csrf(withDefaults()).cors(cors -> cors.disable()).authorizeHttpRequests(requests -> requests
                // Consentiti a tutti (occasionali)
                .requestMatchers(HttpMethod.GET, "/", "/index", "/books/**", "/authors/**",
                        "/login", "/register", "/css/**", "/images/**", "favicon.ico")
                .permitAll().requestMatchers(HttpMethod.POST, "/register", "/login", "/images/**")
                .permitAll()

                // Solo ADMIN_ROLE
                .requestMatchers("/admin/**").hasAuthority(ADMIN_ROLE)

                // Solo DEFAULT_ROLE
                .requestMatchers("/user/**").hasAuthority(DEFAULT_ROLE)

                // Qualunque altra richiesta: autenticazione
                .anyRequest().authenticated()).formLogin(login -> login.loginPage("/login") // Pagina di login di default
                // per tutti
                .loginProcessingUrl("/login") // URL di submit form login user
                .usernameParameter("username").passwordParameter("pwd")
                .successHandler((request, response, authentication) -> {
                    // Success handler custom: redirect in base al ruolo
                    var principal = authentication.getPrincipal();
                    // Recupero id utente dal Principal
                    Long idUtente = null;
                    String username = null;
                    if (principal instanceof org.springframework.security.core.userdetails.UserDetails userDetails) {
                        // Ottieni ID utente qui secondo la tua implementazione
                        // Esempio: CredentialsService -> trova utente per username
                        username = userDetails.getUsername();
                        idUtente = this.credentialsService.findByUsername(username).getUser().getId();

                    }
                    boolean isAdmin = this.credentialsService.findByUsername(username).getRole().equals(ADMIN_ROLE);
                    if (isAdmin) {
                        // Se ADMIN, redirect operatore (sostituisci idUtente)
                        response.sendRedirect(idUtente != null ? "/admin/books" : "/login");
                    } else {
                        // Se Utente, redirect utente (sostituisci idUtente)
                        response.sendRedirect(idUtente != null ? "/user/books" : "/login");
                    }
                }).failureUrl("/login?error=true").permitAll()).logout(logout -> logout.logoutUrl("/logout")
                .logoutSuccessUrl("/").invalidateHttpSession(true).deleteCookies("JSESSIONID")
                .clearAuthentication(true).permitAll());
		return httpSecurity.build();
	}
}


--- java/it/uniroma3/siwbooks/authentication/SecurityBeansConfig.java ---
// src/main/java/it/uniroma3/siwbooks/auth/SecurityBeansConfig.java
package it.uniroma3.siwbooks.authentication;

import org.springframework.context.annotation.*;
import org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder;
import org.springframework.security.crypto.password.PasswordEncoder;

@Configuration
public class SecurityBeansConfig {
  @Bean
  public PasswordEncoder passwordEncoder() {
    return new BCryptPasswordEncoder();
  }
}


--- java/it/uniroma3/siwbooks/constant/Nationality.java ---
package it.uniroma3.siwbooks.constant;

public enum Nationality {
    ITALY,
    UK,
    USA, 
    FRANCE, 
    GERMANY, 
    JAPAN,
    COLOMBIA
}



--- java/it/uniroma3/siwbooks/controller/AdminAuthorController.java ---
// src/main/java/it/uniroma3/siwbooks/controller/admin/AdminBookController.java
package it.uniroma3.siwbooks.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;

import jakarta.validation.Valid;
import it.uniroma3.siwbooks.model.Book;
import it.uniroma3.siwbooks.service.AuthorService;
import it.uniroma3.siwbooks.service.BookService;

@Controller
public class AdminAuthorController {

    @Autowired 
    private BookService bookService;

    @Autowired 
    private AuthorService authorService;

    @PostMapping("/admin/authors/{id}")
    public String deleteBook(@PathVariable("id") Long id){
        authorService.deleteById(id);
        return "redirect:/admin/authors";
    }
}


--- java/it/uniroma3/siwbooks/controller/AdminBookController.java ---
// src/main/java/it/uniroma3/siwbooks/controller/admin/AdminBookController.java
package it.uniroma3.siwbooks.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.*;

import jakarta.validation.Valid;
import it.uniroma3.siwbooks.model.Book;
import it.uniroma3.siwbooks.service.AuthorService;
import it.uniroma3.siwbooks.service.BookService;

@Controller
public class AdminBookController {

    @Autowired 
    private BookService bookService;

    @Autowired 
    private AuthorService authorService;

    @PostMapping("/admin/books/{id}")
    public String deleteBook(@PathVariable("id") Long id){
        bookService.deleteById(id);
        return "redirect:/admin/books";
    }
}


--- java/it/uniroma3/siwbooks/controller/AuthorController.java ---
package it.uniroma3.siwbooks.controller;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import it.uniroma3.siwbooks.model.Author;
import it.uniroma3.siwbooks.model.User;
import it.uniroma3.siwbooks.service.AuthorService;
import it.uniroma3.siwbooks.service.UserService;

@Controller
public class AuthorController {

    @Autowired
    public AuthorService authorService;

    @Autowired
    public UserService userService;

    @GetMapping("/authors")
    public String listAuthors(Model model){
        model.addAttribute("authors", this.authorService.findAll());
        return "authors";
    }

    @GetMapping("/authors/{id}")
    public String viewAuthor(@PathVariable Long id ,Model model){
        Author author = authorService.findById(id);

        if(author==null){
            return "error";
        }
        model.addAttribute("author", author);
        return "author";
    }

    @GetMapping("/user/authors")
    public String listUserAuthors(Model model){
        User user = userService.getCurrentUser();
        if(user == null){
            return "redirect:/login";
        } 
        model.addAttribute("user", user);
        model.addAttribute("authors", this.authorService.findAll());
        return "user/authors";
    }

    @GetMapping("/user/authors/{id}")
    public String viewUserAuthor(@PathVariable Long id ,Model model){
        Author author = authorService.findById(id);
        User user = userService.getCurrentUser();

        if(author==null){
            return "error";
        }
        if(user == null){
            return "redirect:/login";
        } 
        model.addAttribute("user", user);
        model.addAttribute("author", author);
        return "user/author";
    }

    @GetMapping("/admin/authors")
    public String listAdminAuthors(Model model){
        User user = userService.getCurrentUser();
        if(user == null){
            return "redirect:/login";
        } 
        model.addAttribute("user", user);
        model.addAttribute("authors", this.authorService.findAll());
        return "admin/authors";
    }

    @GetMapping("/admin/authors/{id}")
    public String viewAdminAuthor(@PathVariable Long id ,Model model){
        Author author = authorService.findById(id);
        User user = userService.getCurrentUser();

        if(author==null){
            return "error";
        }
        if(user == null){
            return "redirect:/login";
        } 
        model.addAttribute("user", user);
        model.addAttribute("author", author);
        return "admin/author";
    }
}

--- java/it/uniroma3/siwbooks/controller/BookController.java ---
package it.uniroma3.siwbooks.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;

import it.uniroma3.siwbooks.model.Book;
import it.uniroma3.siwbooks.model.User;
import it.uniroma3.siwbooks.service.BookService;
import it.uniroma3.siwbooks.service.ReviewService;
import it.uniroma3.siwbooks.service.UserService;

@Controller
public class BookController {

    @Autowired
    private BookService bookService;
    @Autowired
    private UserService userService;
    @Autowired
    private ReviewService reviewService;


    @GetMapping("/books")
    public String listBooks(Model model) {
        model.addAttribute("books", bookService.findAll());
        return "books";
    }

    @GetMapping("/books/{id}")
    public String viewBook(@PathVariable("id") Long id, Model model) {
        Book book = bookService.findById(id);
        if(book == null){
            return "error";
        }
        model.addAttribute("book", book);

        return "book";
    }

    @GetMapping("/user/books")
    public String listUserBooks(Model model) {
        User user = userService.getCurrentUser();
        if (user == null){
            return "redirect:/login";
        }

        model.addAttribute("books", bookService.findAll());
        model.addAttribute("user", user);
        return "user/books";
    }

    @GetMapping("/user/books/{id}")
    public String viewUserBook(@PathVariable("id") Long id, Model model) {
        Book book = bookService.findById(id);
        User user = userService.getCurrentUser();

        if(book == null){
            return "error.html";
        }
        if (user == null){
            return "redirect:/login";
        }
        boolean hasReview = reviewService.existsByUserAndBook(user, book);
        model.addAttribute("hasReview", hasReview);
        model.addAttribute("book", book);
        model.addAttribute("user", user);
        return "user/book";
    }
    @GetMapping("/admin/books")
    public String listAdminBooks(Model model) {
        User user = userService.getCurrentUser();
        if (user == null){
            return "redirect:/login";
        }

        model.addAttribute("books", bookService.findAll());
        model.addAttribute("user", user);
        return "admin/books";
    }

    @GetMapping("/admin/books/{id}")
    public String viewAdminBook(@PathVariable("id") Long id, Model model) {
        Book book = bookService.findById(id);
        User user = userService.getCurrentUser();

        if(book == null){
            return "error.html";
        }
        if (user == null){
            return "redirect:/login";
        }
        boolean hasReview = reviewService.existsByUserAndBook(user, book);
        model.addAttribute("hasReview", hasReview);
        model.addAttribute("book", book);
        model.addAttribute("user", user);
        return "admin/book";
    }
}



--- java/it/uniroma3/siwbooks/controller/HomeController.java ---
// src/main/java/it/uniroma3/siwbooks/controller/HomeController.java
package it.uniroma3.siwbooks.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class HomeController {

    @GetMapping("/")
    public String home() {
        // forward root → your list of books
        return "redirect:/books";
    }
}



--- java/it/uniroma3/siwbooks/controller/LoginController.java ---
package it.uniroma3.siwbooks.controller;

import java.util.Optional;

import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;

@Controller
public class LoginController {

    @GetMapping("/login")
    public String login(@RequestParam Optional<String> error, Model model) {
        model.addAttribute("loginError", error.isPresent());
        return "login";
    }
}



--- java/it/uniroma3/siwbooks/controller/RegisterController.java ---
package it.uniroma3.siwbooks.controller;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.validation.BindingResult;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.ModelAttribute;
import org.springframework.web.bind.annotation.PostMapping;

import it.uniroma3.siwbooks.model.Credentials;
import it.uniroma3.siwbooks.model.User;
import it.uniroma3.siwbooks.service.CredentialsService;
import jakarta.validation.Valid;

@Controller
public class RegisterController {

    @Autowired
    private CredentialsService credentialsService;

    /**
     * Mostra la pagina di registrazione.
     */
    @GetMapping("/register")
    public String showRegister(Model model) {
        // crea Credentials E lo “collega” a un nuovo User
        Credentials credentials = new Credentials();
        credentials.setUser(new User());     // ← inizializza il user interno

        model.addAttribute("credentials", credentials);
        return "register";
    }



    /**
     * Processa il form di registrazione.
    */
    @PostMapping("/register")
    public String registerUser(
        @Valid @ModelAttribute("credentials") Credentials credentials,
        BindingResult binding
    ) {
        if (credentialsService.existsByUsername(credentials.getUsername())) {
            binding.rejectValue("username","error.credentials","Username già esistente");
        }
        if (binding.hasErrors()) return "register";

        // role e user già collegati
        credentials.setRole(Credentials.DEFAULT_ROLE);
        credentialsService.save(credentials);
        return "redirect:/login?registered";
    }

}



--- java/it/uniroma3/siwbooks/controller/ReviewController.java ---
package it.uniroma3.siwbooks.controller;


import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;
import org.springframework.web.bind.annotation.*;


import it.uniroma3.siwbooks.model.Book;

import it.uniroma3.siwbooks.model.Review;
import it.uniroma3.siwbooks.model.User;
import it.uniroma3.siwbooks.service.*;

@Controller
public class ReviewController {

    @Autowired 
    private ReviewService reviewService;

    @Autowired 
    private CredentialsService credentialsService;

    @Autowired 
    private UserService userService;

    @Autowired 
    private BookService bookService;

    private boolean verifyId(Long id1, Long id2){
        return Objects.equals(id1, id2);
    }


    @PostMapping("/user/{userId}/books/{bookId}/review")
    public String addReview(@PathVariable("userId") Long userId,
                            @PathVariable("bookId")  Long bookId,
                            @RequestParam("title") String title,
                            @RequestParam("text") String text,
                            @RequestParam("mark") int mark,
                            Model model) {
        Book book = this.bookService.findById(bookId);
        User user = this.userService.getCurrentUser();

        if (book == null || user == null || !verifyId(userId, user.getId())){
            return "redirect:/login";
        }

        boolean hasReview = reviewService.existsByUserAndBook(user, book);

        model.addAttribute("hasReview", hasReview);

        this.reviewService.save(new Review(title, mark, text, user, book));
        return "redirect:/user/books/" + bookId;
    }

    @PostMapping("/admin/{userId}/books/{bookId}/review")
    public String addAdminReview(@PathVariable("userId") Long userId,
                            @PathVariable("bookId")  Long bookId,
                            @RequestParam("title") String title,
                            @RequestParam("text") String text,
                            @RequestParam("mark") int mark,
                            Model model) {
        Book book = this.bookService.findById(bookId);
        User user = this.userService.getCurrentUser();

        if (book == null || user == null || !verifyId(userId, user.getId())){
            return "redirect:/login";
        }

        boolean hasReview = reviewService.existsByUserAndBook(user, book);

        model.addAttribute("hasReview", hasReview);

        this.reviewService.save(new Review(title, mark, text, user, book));
        return "redirect:/admin/books/" + bookId;
    }

    @PostMapping("/admin/review/{id}/delete")
    public String deleteReview(@PathVariable("id") Long id){
        User user = this.userService.getCurrentUser();
        Review review = reviewService.findById(id);
        Book book = review.getBook();

        if (book == null || user == null){
            return "redirect:/login";
        }

        reviewService.deleteById(id);
        return "redirect:/admin/books/" + book.getId();
    }
}


--- java/it/uniroma3/siwbooks/controller/UserController.java ---
package it.uniroma3.siwbooks.controller;

import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Controller;
import org.springframework.ui.Model;

import it.uniroma3.siwbooks.service.CredentialsService;
import it.uniroma3.siwbooks.service.UserService;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.RequestParam;

import it.uniroma3.siwbooks.model.User;


@Controller
public class UserController {

    @Autowired
    private UserService userService;
    
    @Autowired
    private CredentialsService credentialsService;

    private boolean verifyId(Long idUrl, Long idUser) {
		return idUser!= null && Objects.equals(idUrl, idUser);
	}

    @GetMapping("/user/{id}")
    public String showProfile(@PathVariable("id") Long id,
            @RequestParam(value="showPasswordModal", required = false, defaultValue = "false") boolean showPasswordModal,
            Model model) {
        User user = userService.getCurrentUser();
        if (!verifyId(id, user.getId())){
            return "redirect:/login";
        }
        model.addAttribute("showPasswordModal", showPasswordModal);
        model.addAttribute("user", user);
        return "user/profile";
    }

    @GetMapping("/admin/{id}")
    public String showAdminProfile(@PathVariable("id") Long id,
            @RequestParam(value="showPasswordModal", required = false, defaultValue = "false") boolean showPasswordModal,
            Model model) {
        User user = userService.getCurrentUser();
        if (!verifyId(id, user.getId())){
            return "redirect:/login";
        }
        model.addAttribute("showPasswordModal", showPasswordModal);
        model.addAttribute("user", user);
        return "admin/profile";
    }
}

--- java/it/uniroma3/siwbooks/model/Author.java ---

package it.uniroma3.siwbooks.model;

import java.time.LocalDate;
import java.util.ArrayList;
import java.util.List;

import org.springframework.format.annotation.DateTimeFormat;

import it.uniroma3.siwbooks.constant.Nationality;
import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.EnumType;
import jakarta.persistence.Enumerated;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToMany;
import jakarta.persistence.OneToOne;
import jakarta.validation.constraints.NotEmpty;
import jakarta.validation.constraints.NotNull;
import jakarta.validation.constraints.Past;
import jakarta.validation.constraints.PastOrPresent;



@Entity
public class Author {
    @Id
    @GeneratedValue
    private Long id;

    @NotEmpty
    private String name;

    @NotEmpty
    private String surname;

    @NotNull
    @Past
    @DateTimeFormat(pattern = "dd-MM-yyyy")
    private LocalDate birthDate;

    @PastOrPresent
    @DateTimeFormat(pattern = "dd-MM-yyyy")
    private LocalDate deathDate;

    @NotNull
	@Enumerated(EnumType.STRING)
    private Nationality nationality;


    @ManyToMany(mappedBy = "authors", cascade = CascadeType.ALL)
    private List<Book> books = new ArrayList<>();

    @OneToOne(cascade = CascadeType.ALL)
	private ImageEntity photo;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getName() {
        return name;
    }

    public void setName(String name) {
        this.name = name;
    }

    public String getSurname() {
        return surname;
    }

    public void setSurname(String surname) {
        this.surname = surname;
    }

    public LocalDate getBirthDate() {
        return birthDate;
    }

    public void setBirthDate(LocalDate birthDate) {
        this.birthDate = birthDate;
    }

    public LocalDate getDeathDate() {
        return deathDate;
    }

    public void setDeathDate(LocalDate deathDate) {
        this.deathDate = deathDate;
    }

    public Nationality getNationality() {
        return nationality;
    }

    public void setNationality(Nationality nationality) {
        this.nationality = nationality;
    }

    public List<Book> getBooks() {
        return books;
    }

    public void setBooks(List<Book> books) {
        this.books = books;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;

        Author author = (Author) o;

        return id != null ? id.equals(author.id) : author.id == null;
    }

    @Override
    public int hashCode() {
        return id != null ? id.hashCode() : 0;
    }

    public ImageEntity getPhoto() {
        return photo;
    }

    public void setPhoto(ImageEntity photo) {
        this.photo = photo;
    }

    public String getFullName() {
        return this.name + " " + this.surname;
    }
}


--- java/it/uniroma3/siwbooks/model/Book.java ---
package it.uniroma3.siwbooks.model;

import java.util.ArrayList;
import java.util.HashSet;
import java.util.List;
import java.util.Set;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToMany;
import jakarta.persistence.OneToMany;

@Entity
public class Book {

    @Id 
    @GeneratedValue
    private Long id;

    private String title;
    private Integer publicationYear;

    /* --- relazioni ---------------------------------------------------- */

    @ManyToMany
    private Set<Author> authors = new HashSet<>();

    @OneToMany(cascade = CascadeType.ALL)
    private List<ImageEntity> images = new ArrayList<>();

    @OneToMany(
      mappedBy = "book",
      cascade = CascadeType.ALL,
      orphanRemoval = true
    )
    private List<Review> reviews = new ArrayList<>();
    
    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public Integer getPublicationYear() {
        return publicationYear;
    }

    public void setPublicationYear(Integer publicationYear) {
        this.publicationYear = publicationYear;
    }

    public Set<Author> getAuthors() {
        return authors;
    }

    public void setAuthors(Set<Author> authors) {
        this.authors = authors;
    }

    public List<ImageEntity> getImages() {
        return images;
    }

    public void setImages(List<ImageEntity> images) {
        this.images = images;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (!(o instanceof Book)) return false;
        Book book = (Book) o;
        return id != null && id.equals(book.id);
    }

    @Override
    public int hashCode() {
        return 31 + (id == null ? 0 : id.hashCode());
    }

    public List<Review> getReviews() {
        return reviews;
    }

    public void setReviews(List<Review> reviews) {
        this.reviews = reviews;
    }
}

--- java/it/uniroma3/siwbooks/model/Credentials.java ---
package it.uniroma3.siwbooks.model;

import java.util.Objects;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToOne;
import jakarta.validation.constraints.NotEmpty;

@Entity
public class Credentials {

    public static final String DEFAULT_ROLE = "DEFAULT";
    public static final String ADMIN_ROLE   = "ADMIN";

    @Id @GeneratedValue 
    private Long id;

    @NotEmpty 
    private String username;
    
    @NotEmpty 
    private String password;

    @NotEmpty 
    private String role = DEFAULT_ROLE;

    @OneToOne(cascade = CascadeType.ALL)
    private User user;
	
	public String getUsername() {
		return username;
	}
	
	public Long getId() {
		return id;
	}

	public void setId(Long id) {
		this.id = id;
	}

	public User getUser() {
		return user;
	}

	public void setUser(User user) {
		this.user = user;
	}
	
	public void setUsername(String username) {
		this.username = username;
	}
	
	public String getPassword() {
		return password;
	}
	
	public void setPassword(String password) {
		this.password = password;
	}
	
	public String getRole() {
		return role;
	}
	
	public void setRole(String role) {
		this.role = role;
	}

	@Override
	public int hashCode() {
		return Objects.hash(username);
	}

	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		Credentials other = (Credentials) obj;
		return Objects.equals(username, other.username);
	}

	
}


--- java/it/uniroma3/siwbooks/model/ImageEntity.java ---
package it.uniroma3.siwbooks.model;

import java.util.Objects;

import org.springframework.beans.factory.annotation.Autowired;

import jakarta.persistence.*;
import jakarta.validation.constraints.NotNull;


@Entity
public class ImageEntity {

    public static final String PATH = "/images/";   // prefisso URL

    @Id @GeneratedValue
    private Long id;

    @NotNull
    private String name;            // es. "/images/holmes.jpg"

    
    @Autowired
    protected ImageEntity() { }                 // JPA


    public Long getId() {
        return id;
    }
    public void setId(Long id) {
        this.id = id;
    }
    public String getName() {
        return name;
    }
    public void setName(String name) {
        this.name = name;
    }


    @Override
    public int hashCode() {
        final int prime = 31;
        int result = 1;
        result = prime * result + ((id == null) ? 0 : id.hashCode());
        result = prime * result + ((name == null) ? 0 : name.hashCode());
        return result;
    }


	@Override
	public boolean equals(Object obj) {
		if (this == obj)
			return true;
		if (obj == null)
			return false;
		if (getClass() != obj.getClass())
			return false;
		ImageEntity other = (ImageEntity) obj;
		return Objects.equals(name, other.name);
	}

}



--- java/it/uniroma3/siwbooks/model/Review.java ---
package it.uniroma3.siwbooks.model;
import java.util.Objects;

import jakarta.persistence.Column;
import jakarta.persistence.Entity;
import jakarta.persistence.FetchType;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.ManyToOne;
import jakarta.validation.constraints.Max;
import jakarta.validation.constraints.Min;
import jakarta.validation.constraints.NotEmpty;
import jakarta.validation.constraints.NotNull;

@Entity
public class Review {

    public Review(@NotEmpty @NotNull String title, @Min(1) @Max(5) int mark, @NotEmpty @NotNull String text, User user,
            Book book) {
        this.title = title;
        this.mark = mark;
        this.text = text;
        this.user = user;
        this.book = book;
    }

    public Review() {
    }

    @Id
    @GeneratedValue(strategy = GenerationType.AUTO)
    private Long id;

    @NotEmpty
    @NotNull
    private String title;

    @Min(1) @Max(5)
    private int mark; 

    @NotEmpty
    @NotNull
    @Column(length=2000)
    private String text;

    @ManyToOne()
    private User user;

    @ManyToOne(fetch = FetchType.LAZY)
    private Book book;


    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getTitle() {
        return title;
    }

    public void setTitle(String title) {
        this.title = title;
    }

    public int getMark() {
        return mark;
    }

    public void setMark(int mark) {
        this.mark = mark;
    }

    public String getText() {
        return text;
    }

    public void setText(String text) {
        this.text = text;
    }

    public User getUser() {
        return user;
    }

    public void setUser(User user) {
        this.user = user;
    }

    @Override
    public int hashCode() {
        int hash = 5;
        hash = 41 * hash + Objects.hashCode(this.id);
        hash = 41 * hash + Objects.hashCode(this.title);
        hash = 41 * hash + this.mark;
        hash = 41 * hash + Objects.hashCode(this.text);
        hash = 41 * hash + Objects.hashCode(this.user);
        return hash;
    }

    @Override
    public boolean equals(Object obj) {
        if (this == obj) {
            return true;
        }
        if (obj == null) {
            return false;
        }
        if (getClass() != obj.getClass()) {
            return false;
        }
        final Review other = (Review) obj;
        if (this.mark != other.mark) {
            return false;
        }
        if (!Objects.equals(this.title, other.title)) {
            return false;
        }
        if (!Objects.equals(this.text, other.text)) {
            return false;
        }
        if (!Objects.equals(this.id, other.id)) {
            return false;
        }
        return Objects.equals(this.user, other.user);
    }

    public Book getBook() {
        return book;
    }

    public void setBook(Book book) {
        this.book = book;
    }

}

--- java/it/uniroma3/siwbooks/model/User.java ---
package it.uniroma3.siwbooks.model;

import java.util.List;

import jakarta.persistence.CascadeType;
import jakarta.persistence.Entity;
import jakarta.persistence.GeneratedValue;
import jakarta.persistence.GenerationType;
import jakarta.persistence.Id;
import jakarta.persistence.OneToMany;
import jakarta.persistence.SequenceGenerator;
import jakarta.persistence.Table;
import jakarta.validation.constraints.NotEmpty;
import jakarta.validation.constraints.NotNull;

@Entity
@Table(name = "users")
@SequenceGenerator(
  name = "users_seq_gen",      // un nome a tua scelta
  sequenceName = "users_seq",  // la sequenza che hai creato in import.sql
  allocationSize = 50          // deve corrispondere all'INCREMENT BY di users_seq
)
public class User {

    @Id
    @GeneratedValue(
      strategy = GenerationType.SEQUENCE,
      generator = "users_seq_gen"
    )
    private Long id;

    @NotNull @NotEmpty
    private String nome;

    @NotNull @NotEmpty
    private String cognome;

    @NotNull @NotEmpty
    private String email;

    @OneToMany(mappedBy="user", cascade=CascadeType.ALL)
    private List<Review> recensioni;

    public Long getId() {
        return id;
    }

    public void setId(Long id) {
        this.id = id;
    }

    public String getNome() {
        return nome;
    }

    public void setNome(String nome) {
        this.nome = nome;
    }

    public String getCognome() {
        return cognome;
    }

    public void setCognome(String cognome) {
        this.cognome = cognome;
    }

    public String getEmail() {
        return email;
    }

    public void setEmail(String email) {
        this.email = email;
    }

    public List<Review> getRecensioni() {
        return recensioni;
    }

    public void setRecensioni(List<Review> recensioni) {
        this.recensioni = recensioni;
    }

    @Override
    public boolean equals(Object o) {
        if (this == o) return true;
        if (o == null || getClass() != o.getClass()) return false;
        User user = (User) o;
        return id != null && id.equals(user.id);
    }

    @Override
    public int hashCode() {
        return id != null ? id.hashCode() : 0;
    }
}


--- java/it/uniroma3/siwbooks/repository/AuthorRepository.java ---
package it.uniroma3.siwbooks.repository;
import org.springframework.data.jpa.repository.JpaRepository;
import it.uniroma3.siwbooks.model.Author;

public interface AuthorRepository extends JpaRepository<Author, Long>{

}


--- java/it/uniroma3/siwbooks/repository/BookRepository.java ---
package it.uniroma3.siwbooks.repository;

import it.uniroma3.siwbooks.model.Book;
import org.springframework.data.jpa.repository.JpaRepository;

public interface BookRepository extends JpaRepository<Book, Long> {
}


--- java/it/uniroma3/siwbooks/repository/CredentialsRepository.java ---
package it.uniroma3.siwbooks.repository;

import java.util.Optional;

import org.springframework.data.jpa.repository.JpaRepository;

import it.uniroma3.siwbooks.model.Credentials;
import it.uniroma3.siwbooks.model.User;

// CredentialsRepository.java
public interface CredentialsRepository extends JpaRepository<Credentials, Long> {

    Optional<Credentials> findByUsername(String username);
    boolean existsByUsername(String username);
}




--- java/it/uniroma3/siwbooks/repository/ImageEntityRepository.java ---

package it.uniroma3.siwbooks.repository;

import org.springframework.data.jpa.repository.JpaRepository;

import it.uniroma3.siwbooks.model.ImageEntity;

public interface ImageEntityRepository extends JpaRepository<ImageEntity, Long> { }


--- java/it/uniroma3/siwbooks/repository/ReviewRepository.java ---
package it.uniroma3.siwbooks.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import it.uniroma3.siwbooks.model.*;
import java.util.Optional;

public interface ReviewRepository extends JpaRepository<Review, Long> {
  boolean existsByUserAndBook(User user, Book book);
  Optional<Review> findByUserAndBook(User user, Book book);
}


--- java/it/uniroma3/siwbooks/repository/UserRepository.java ---
/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/Classes/Class.java to edit this template
 */

package it.uniroma3.siwbooks.repository;

import org.springframework.data.jpa.repository.JpaRepository;
import it.uniroma3.siwbooks.model.User;

public interface UserRepository extends JpaRepository<User, Long> {

}


--- java/it/uniroma3/siwbooks/service/AuthorService.java ---
package it.uniroma3.siwbooks.service;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import it.uniroma3.siwbooks.model.Author;
import it.uniroma3.siwbooks.repository.AuthorRepository;

@Service
public class AuthorService {
    @Autowired
    public AuthorRepository authorRepository;
    
    public List<Author> findAll() {
        return authorRepository.findAll();
    }

    public Author findById(Long id) {
        return authorRepository.findById(id).orElse(null);
    }

    public void save(Author author){
        authorRepository.save(author);
    }

    public void deleteById(Long id){
        authorRepository.deleteById(id);
    }
}

--- java/it/uniroma3/siwbooks/service/BookService.java ---
// src/main/java/it/uniroma3/siwbooks/service/BookService.java
package it.uniroma3.siwbooks.service;

import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import it.uniroma3.siwbooks.model.Book;
import it.uniroma3.siwbooks.repository.BookRepository;

@Service
public class BookService {

    @Autowired private BookRepository repo;

    public List<Book> findAll(){
         return repo.findAll(); 
        }

    public Book findById(Long id){
        return repo.findById(id).orElse(null); 
    }

    /** inserisce o aggiorna */
    public Book save(Book b){ 
        return repo.save(b); 
    }

    public void deleteById(Long id){
        repo.deleteById(id);
    }
}


--- java/it/uniroma3/siwbooks/service/CredentialsService.java ---
// src/main/java/it/uniroma3/siwbooks/service/CredentialsService.java
package it.uniroma3.siwbooks.service;

import java.util.Optional;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.security.core.context.SecurityContextHolder;
import org.springframework.security.core.userdetails.*;
import org.springframework.security.crypto.password.PasswordEncoder;
import org.springframework.stereotype.Service;

import static it.uniroma3.siwbooks.model.Credentials.ADMIN_ROLE;
import static it.uniroma3.siwbooks.model.Credentials.DEFAULT_ROLE;

import it.uniroma3.siwbooks.model.Credentials;
import it.uniroma3.siwbooks.repository.CredentialsRepository;
import jakarta.validation.Valid;

import it.uniroma3.siwbooks.model.User;

@Service
public class CredentialsService {

    @Autowired
    private CredentialsRepository credentialsRepository;

    @Autowired
    private PasswordEncoder passwordEncoder;

    /** Per recuperare l’utente in BookController */
    public Credentials findByUsername(String username) {
        return credentialsRepository.findByUsername(username).orElse(null);
    }

    public void save(@Valid Credentials credentials) {
        credentials.setRole(DEFAULT_ROLE);
        credentials.setPassword(this.passwordEncoder.encode(credentials.getPassword()));
        credentialsRepository.save(credentials);
    }

    public boolean existsByUsername(String u) {
        return credentialsRepository.existsByUsername(u);
    }

    public User getCurrentUser(){
        UserDetails userDetails = (UserDetails) SecurityContextHolder.getContext().getAuthentication().getPrincipal();
        return this.findByUsername(userDetails.getUsername()).getUser();
    }
}


--- java/it/uniroma3/siwbooks/service/ImageEntityService.java ---
package it.uniroma3.siwbooks.service;

import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Service;
import it.uniroma3.siwbooks.model.ImageEntity;
import it.uniroma3.siwbooks.repository.ImageEntityRepository;
import jakarta.transaction.Transactional;

import static it.uniroma3.siwbooks.model.ImageEntity.PATH;

@Service
public class ImageEntityService {
    
	@Autowired
    private ImageEntityRepository imageEntityRepository;
	
    @Value("${upload.dir}")
    private String uploadDir;

    public ImageEntity getImage(Long id) {
        return imageEntityRepository.findById(id).orElse(null);
    }
}


--- java/it/uniroma3/siwbooks/service/ReviewService.java ---
package it.uniroma3.siwbooks.service;

import java.util.NoSuchElementException;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;
import org.springframework.transaction.annotation.Transactional;

import it.uniroma3.siwbooks.model.*;
import it.uniroma3.siwbooks.repository.*;

@Service
public class ReviewService {

    @Autowired private ReviewRepository reviewRepo;
    @Autowired private BookRepository   bookRepo;
    @Autowired private UserRepository   userRepo;


    public void save(Review review) {
        if (reviewRepo.existsByUserAndBook(review.getUser(), review.getBook())) {
        throw new IllegalStateException("Hai già recensito questo libro");
    }
       reviewRepo.save(review);
    }

    public boolean existsByUserAndBook(User user, Book book){
        return reviewRepo.existsByUserAndBook(user, book);
    }

    public Review findById(Long id){
        return reviewRepo.findById(id).orElse(null);
    }

    public void deleteById(Long id){
        reviewRepo.deleteById(id);
    }
}


--- java/it/uniroma3/siwbooks/service/UserService.java ---
package it.uniroma3.siwbooks.service;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import it.uniroma3.siwbooks.model.User;
import it.uniroma3.siwbooks.repository.UserRepository;
import jakarta.validation.Valid;

@Service
public class UserService {
    @Autowired
    private UserRepository userRepository;

    @Autowired
	private CredentialsService credentialsService;

    public User getCurrentUser(){
        return credentialsService.getCurrentUser();
    }

    public User findById(Long id){
        return userRepository.findById(id).orElse(null);
    }

    public void save(@Valid User user){
        userRepository.save(user);
    }
}

--- resources/templates/admin/author.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/author.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">

</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/admin/books}" class="navbar-link">Libri</a>
          <a th:href="@{/admin/authors}" class="navbar-link active">Autori</a>
          <a th:href="@{'/admin/' + ${user.id}}" class="navbar-link">Profilo</a>
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

    <main class="main-content">
      <div class="author-card">
        <img th:if="${author.photo==null}"
             src="/images/placeholder.jpg" 
             alt="Nessuna foto autore">
        <img th:unless="${author.photo==null}"
             th:src="${author.photo.name}" 
             th:alt="'Foto di ' + ${author.getFullName()}">
        <div th:text="'Nome: ' + ${author.name}"></div>
        <div th:text="'Cognome: ' + ${author.surname}"></div>
        <div th:text="'Nato il: ' + ${author.birthDate}"></div>
        <div th:if="${author.deathDate!=null}" th:text="'Morto il: ' + ${author.deathDate}"></div>
        <div th:text="'Nazionalità: ' + ${#strings.capitalize(#strings.toLowerCase(author.nationality))}"></div>
      </div>

      <div th:if="${author.books != null and !author.books.empty}">
          <div th:if="${author.books.empty}" class="empty-message">
            Nessun libro disponibile
          </div>

          <div th:unless="${author.books.empty}" class="books-grid">
            <div th:each="book : ${author.books}" class="book-card">
              <div class="book-cover-wrapper">
                <img th:if="${book.images != null and !book.images.empty}"
                    th:src="${book.images[0].name}"
                    th:alt="'Copertina di ' + ${book.title}" />
                <img th:unless="${book.images != null and !book.images.empty}"
                    src="/images/placeholder.jpg"
                    alt="Nessuna immagine disponibile" />
              </div>
              <div class="book-info">
                <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>


    <footer class="footer">
    <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
    </div>
	</footer>

</body>
</html>

--- resources/templates/admin/authors.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/authors.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
  </head>
  <body>
    <header class="header">
      <nav class="navbar">
        <div class="navbar-content">
          <div class="navbar-links-group">
            <h1 class="navbar-Title">SiwBooks</h1>
          </div>
          <div class="navbar-links-group">
            <a th:href="@{/}" class="navbar-link">Home</a>
            <a th:href="@{/admin/books}" class="navbar-link">Libri</a>
            <a th:href="@{/admin/authors}" class="navbar-link active">Autori</a>
            <a th:href="@{'/admin/' + ${user.id}}" class="navbar-link"
              >Profilo</a
            >
            <form th:action="@{/logout}" method="post">
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="navbar-link">Esci</button>
            </form>
          </div>
        </div>
      </nav>
    </header>

    <main class="main-content">
      <div th:if="${authors.empty}" class="no-content">
        Nessun autore disponibile
      </div>
      <div th:unless="${authors.empty}" class="authors-grid">
        <div th:each="author : ${authors}" class="author-card">
          <img
            th:if="${author.photo == null}"
            src="/images/placeholder.jpg"
            alt="Nessuna immagine autore"
          />
          <img
            th:if="${author.photo != null}"
            th:src="${author.photo.name}"
            alt="Immagine autore"
          />
          <div class="author-info">
            <h2 th:text="${author.getFullName()}">Full Name</h2>
            <a
              th:href="@{'/admin/authors/' + ${author.id}}"
              class="view-details-link"
              >Dettagli</a
            >

            <form
              th:action="@{'/admin/authors/' + ${author.id}}"
              method="post"
              class="delete-form"
            >
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="delete-button">Elimina</button>
            </form>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
      </div>
    </footer>
  </body>
</html>


--- resources/templates/admin/book.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/book.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
  </head>

  <body>
    <header class="header">
      <nav class="navbar">
        <div class="navbar-content">
          <div class="navbar-links-group">
            <h1 class="navbar-Title">SiwBooks</h1>
          </div>
          <div class="navbar-links-group">
            <a th:href="@{/}" class="navbar-link">Home</a>
            <a th:href="@{/admin/books}" class="navbar-link active">Libri</a>
            <a th:href="@{/admin/authors}" class="navbar-link">Autori</a>
            <a th:href="@{'/admin/' + ${user.id}}" class="navbar-link"
              >Profilo</a
            >
            <form th:action="@{/logout}" method="post">
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="navbar-link">Esci</button>
            </form>
          </div>
        </div>
      </nav>
    </header>

    <main class="details-container">
      <div class="book-details">
        <!-- Section IMAGES ORIZZONTALI -->
        <div class="images-container">
          <div class="images-grid" th:if="${not #lists.isEmpty(book.images)}">
            <div th:each="img : ${book.images}" class="image-item">
              <img
                th:src="@{${img.name}}"
                class="book-img"
                th:alt="'Immagine del libro ' + ${book.title}"
              />
            </div>
          </div>
          <!-- Placeholder for no images -->
          <div
            th:if="${#lists.isEmpty(book.images)}"
            class="no-images-placeholder"
          >
            Nessuna immagine disponibile
          </div>
        </div>
        <!-- Book Information Section -->
        <div class="book-info">
          <h1 class="book-title" th:text="${book.title}">Titolo del Libro</h1>
          <!-- Authors Section -->
          <div class="info-section">
            <h2>Autori</h2>
            <div class="authors-list">
              <a
                th:each="author : ${book.authors}"
                th:href="@{'/admin/authors/' + ${author.id}}"
                class="author-link"
                th:text="${author.name + ' ' + author.surname}"
              >
                Nome Autore
              </a>
            </div>
          </div>
          <!-- Publication Year Section -->
          <div class="info-section">
            <h2>Anno di Pubblicazione</h2>
            <p th:text="${book.publicationYear}">2023</p>
          </div>
        </div>
      </div>
      <!-- Reviews Section -->
      <div class="info-section">
        <h2>Recensioni</h2>
        <!-- Reviews List -->
        <div class="reviews-list" th:if="${not #lists.isEmpty(book.reviews)}">
          <div th:each="review : ${book.reviews}" class="review-item">
            <h4
              class="review-title"
              th:text="'Titolo: ' + ${review.title} + ' [ ' + ${review.user.nome} + ' ' + ${review.user.cognome} + ' ]'"
            >
              Titolo recensione
            </h4>
            <p class="review-text">Testo:</p>
            <p class="review-text" th:text="${review.text}">
              Testo della recensione
            </p>
            <p
              class="review-rating"
              th:text="${'Valutazione: ' + review.mark + '/5'}"
            >
              Valutazione: 5/5
            </p>
            <form
              th:action="@{'/admin/review/' + ${review.id} + '/delete'}"
              method="post"
              class="delete-form"
            >
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="delete-button">Elimina</button>
            </form>
          </div>
        </div>
        <!-- No Reviews Message -->
        <div class="reviews-list" th:if="${#lists.isEmpty(book.reviews)}">
          <h3 class="review-empty">Nessuna recensione</h3>
        </div>

        <div th:unless="${hasReview}">
          <form
            th:action="@{'/admin/' + ${user.id} + '/books/' + ${book.id} + '/review'}"
            method="post"
            class="review-form"
          >
            <!-- CSRF -->
            <input
              type="hidden"
              th:name="${_csrf.parameterName}"
              th:value="${_csrf.token}"
            />

            <input type="text" name="title" placeholder="Titolo" required />
            <textarea
              name="text"
              placeholder="Testo della recensione"
              required
            ></textarea>
            <select name="mark" required>
              <option value="" disabled selected>Valutazione</option>
              <option
                th:each="i : ${#numbers.sequence(1,5)}"
                th:value="${i}"
                th:text="${i}"
              >
                1
              </option>
            </select>
            <button type="submit">Invia Recensione</button>
          </form>
        </div>

        <div th:if="${hasReview}" class="already-reviewed">
          Hai già commentato!
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
      </div>
    </footer>
  </body>
</html>


--- resources/templates/admin/books.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <title>Catalogo Libri</title>
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
    <link rel="stylesheet" th:href="@{/css/books.css}" />
  </head>

  <body>
    <header class="header">
      <nav class="navbar">
        <div class="navbar-content">
          <div class="navbar-links-group">
            <h1 class="navbar-Title">SiwBooks</h1>
          </div>
          <div class="navbar-links-group">
            <a th:href="@{/}" class="navbar-link">Home</a>
            <a th:href="@{/admin/books}" class="navbar-link active">Libri</a>
            <a th:href="@{/admin/authors}" class="navbar-link">Autori</a>
            <a th:href="@{'/admin/' + ${user.id}}" class="navbar-link"
              >Profilo</a
            >
            <form th:action="@{/logout}" method="post">
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="navbar-link">Esci</button>
            </form>
          </div>
        </div>
      </nav>
    </header>

    <main class="main-content">
      <div th:if="${books.empty}" class="empty-message">
        Nessun libro disponibile
      </div>

      <div th:unless="${books.empty}" class="books-grid">
        <div th:each="book : ${books}" class="book-card">
          <div class="book-cover-wrapper">
            <img
              th:if="${book.images != null and !book.images.empty}"
              th:src="${book.images[0].name}"
              th:alt="'Copertina di ' + ${book.title}"
            />
            <img
              th:unless="${book.images != null and !book.images.empty}"
              src="/images/placeholder.jpg"
              alt="Nessuna immagine disponibile"
            />
          </div>
          <div class="book-info">
            <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
            <a
              th:href="@{'/admin/books/' + ${book.id}}"
              class="view-details-link"
            >
              Dettagli
            </a>

            <form
              th:action="@{'/admin/books/' + ${book.id}}"
              method="post"
              class="delete-form"
            >
              <input
                type="hidden"
                th:name="${_csrf.parameterName}"
                th:value="${_csrf.token}"
              />
              <button type="submit" class="delete-button">Elimina</button>
            </form>
          </div>
        </div>
      </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
      </div>
    </footer>
  </body>
</html>


--- resources/templates/admin/profile.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/admin/books}" class="navbar-link">Libri</a>
          <a th:href="@{/admin/authors}" class="navbar-link">Autori</a>
          <a th:href="@{'/admin/' + ${user.id}}" class="navbar-link active">Profilo</a>
          <form th:action="@{/logout}" method="post" style="display:inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

  <div class="profile-wrapper">
    <div class="profile-box">
      <h1 th:text="'Bentornato ' + ${user.nome}">Bentornato Mario</h1>
      <p><strong>Nome:</strong> <span th:text="${user.nome}">Mario</span></p>
      <p><strong>Cognome:</strong> <span th:text="${user.cognome}">Rossi</span></p>
      <p><strong>Email:</strong> <span th:text="${user.email}">example@gmail.com</span></p>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>


</body>
</html>



--- resources/templates/admin_book_form.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8" />
  <title th:text="${action=='create' ? 'Nuovo libro' : 'Modifica libro'}">Libro</title>
</head>
<body>
<h1 th:text="${action=='create' ? 'Inserisci nuovo libro' : 'Modifica libro'}"></h1>

<!-- FORM CREAZIONE -->
<form th:if="${action=='create'}"
      th:action="@{/admin/books}"
      th:object="${book}"
      method="post">

  <div>
    <label>Titolo:
      <input type="text" th:field="*{title}" required />
    </label>
  </div>

  <div>
    <label>Anno di pubblicazione:
      <input type="number" th:field="*{publicationYear}" min="0" required />
    </label>
  </div>

  <button type="submit">Crea</button>
  <a th:href="@{/books}">Annulla</a>
</form>

<!-- FORM MODIFICA -->
<form th:if="${action=='edit'}"
      th:action="@{/admin/books/{id}/edit(id=${book.id})}"
      th:object="${book}"
      method="post">

  <div>
    <label>Titolo:
      <input type="text" th:field="*{title}" required />
    </label>
  </div>

  <div>
    <label>Anno di pubblicazione:
      <input type="number" th:field="*{publicationYear}" min="0" required />
    </label>
  </div>

  <button type="submit">Aggiorna</button>
  <a th:href="@{/books}">Annulla</a>
</form>

</body>
</html>


--- resources/templates/author.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/author.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">

</head>
<body>

    <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
      <div class="navbar-links-group">
        <h1 class="navbar-Title">SiwBooks</h1>
      </div>
      <div class="navbar-links-group">
        <a th:href="@{/}" class="navbar-link">Home</a>
        <a th:href="@{/books}" class="navbar-link">Libri</a>
        <a th:href="@{/authors}" class="navbar-link active">Autori</a>
        <a th:href="@{/login}" class="navbar-link">Accedi</a>
          </div>
      </div>
    </nav>
  </header>

    <main class="main-content">
      <div class="author-card">
        <img th:if="${author.photo==null}"
             src="/images/placeholder.jpg" 
             alt="Nessuna foto autore">
        <img th:unless="${author.photo==null}"
             th:src="${author.photo.name}" 
             th:alt="'Foto di ' + ${author.getFullName()}">
        <div th:text="'Nome: ' + ${author.name}"></div>
        <div th:text="'Cognome: ' + ${author.surname}"></div>
        <div th:text="'Nato il: ' + ${author.birthDate}"></div>
        <div th:if="${author.deathDate!=null}" th:text="'Morto il: ' + ${author.deathDate}"></div>
        <div th:text="'Nazionalità: ' + ${#strings.capitalize(#strings.toLowerCase(author.nationality))}"></div>
      </div>

      <div th:if="${author.books != null and !author.books.empty}">
          <div th:if="${author.books.empty}" class="empty-message">
            Nessun libro disponibile
          </div>

          <div th:unless="${author.books.empty}" class="books-grid">
            <div th:each="book : ${author.books}" class="book-card">
              <div class="book-cover-wrapper">
                <img th:if="${book.images != null and !book.images.empty}"
                    th:src="${book.images[0].name}"
                    th:alt="'Copertina di ' + ${book.title}" />
                <img th:unless="${book.images != null and !book.images.empty}"
                    src="/images/placeholder.jpg"
                    alt="Nessuna immagine disponibile" />
              </div>
              <div class="book-info">
                <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>


    <footer class="footer">
    <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
    </div>
	</footer>

</body>
</html>

--- resources/templates/authors.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/authors.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">

</head>
<body>

    <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
      <div class="navbar-links-group">
        <h1 class="navbar-Title">SiwBooks</h1>
      </div>
      <div class="navbar-links-group">
        <a th:href="@{/}" class="navbar-link">Home</a>
        <a th:href="@{/books}" class="navbar-link">Libri</a>
        <a th:href="@{/authors}" class="navbar-link active">Autori</a>
        <a th:href="@{/login}" class="navbar-link">Accedi</a>
          </div>
      </div>
    </nav>
  </header>

    <main class="main-content">
    <div th:if="${authors.empty}" class="no-content"> 
        Nessun autore disponibile
    </div>
    <div th:unless="${authors.empty}" 
        class="authors-grid">
        <div th:each="author : ${authors}"
            class="author-card">
        <img th:if="${author.photo == null}"
            src="/images/placeholder.jpg"
            alt="Nessuna immagine autore"/>
        <img th:if="${author.photo != null}"
            th:src="${author.photo.name}"
            alt="Immagine autore"/>
        <div class="author-info">
            <h2 th:text="${author.getFullName()}">Full Name</h2>
            <a th:href="@{'/authors/' + ${author.id}}"
            class="view-details-link">Dettagli</a>
        </div>
        </div>
    </div>
    </main>


    <footer class="footer">
    <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
    </div>
	</footer>

</body>
</html>

--- resources/templates/book.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/book.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
  </head>

  <body>
    <header class="header">
      <nav class="navbar">
        <div class="navbar-content">
          <div class="navbar-links-group">
            <h1 class="navbar-Title">SiwBooks</h1>
          </div>
          <div class="navbar-links-group">
            <a th:href="@{/}" class="navbar-link">Home</a>
            <a th:href="@{/books}" class="navbar-link active">Libri</a>
            <a th:href="@{/authors}" class="navbar-link">Autori</a>
            <a th:href="@{/login}" class="navbar-link">Accedi</a>
          </div>
        </div>
      </nav>
    </header>

    <main class="details-container">
      <div class="book-details">
        <!-- Section IMAGES ORIZZONTALI -->
        <div class="images-container">
          <div class="images-grid" th:if="${not #lists.isEmpty(book.images)}">
            <div th:each="img : ${book.images}" class="image-item">
              <img
                th:src="@{${img.name}}"
                class="book-img"
                th:alt="'Immagine del libro ' + ${book.title}"
              />
            </div>
          </div>
          <!-- Placeholder for no images -->
          <div
            th:if="${#lists.isEmpty(book.images)}"
            class="no-images-placeholder"
          >
            Nessuna immagine disponibile
          </div>
        </div>
        <!-- Book Information Section -->
        <div class="book-info">
          <h1 class="book-title" th:text="${book.title}">Titolo del Libro</h1>
          <!-- Authors Section -->
          <div class="info-section">
            <h2>Autori</h2>
            <div class="authors-list">
              <a
                th:each="author : ${book.authors}"
                th:href="@{'/authors/' + ${author.id}}"
                class="author-link"
                th:text="${author.name + ' ' + author.surname}"
              >
                Nome Autore
              </a>
            </div>
          </div>
          <!-- Publication Year Section -->
          <div class="info-section">
            <h2>Anno di Pubblicazione</h2>
            <p th:text="${book.publicationYear}">2023</p>
          </div>
        </div>
      </div>
        <!-- Reviews Section -->
        <div class="info-section">
          <h2>Recensioni</h2>
          <!-- Reviews List -->
          <div class="reviews-list" th:if="${not #lists.isEmpty(book.reviews)}">
            <div th:each="review : ${book.reviews}" class="review-item">
              <h4
                class="review-title"
                th:text="'Titolo: ' + ${review.title} + ' [ ' + ${review.user.nome} + ' ' + ${review.user.cognome} + ' ]'"
              >
                Titolo recensione
              </h4>
              <p class="review-text">Testo:</p>
              <p class="review-text" th:text="${review.text}">
                Testo della recensione
              </p>
              <p
                class="review-rating"
                th:text="${'Valutazione: ' + review.mark + '/5'}"
              >
                Valutazione: 5/5
              </p>
            </div>
          </div>
          <!-- No Reviews Message -->
          <div class="reviews-list" th:if="${#lists.isEmpty(book.reviews)}">
            <h3 class="review-empty">Nessuna recensione</h3>
          </div>
          <div class="login-to-review">
            Per scrivere una recensione, <a th:href="@{/login}">accedi qui</a>.
          </div>
        </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
      </div>
    </footer>
  </body>
</html>


--- resources/templates/books.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/books.css}">
</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/books}" class="navbar-link active">Libri</a>
          <a th:href="@{/authors}" class="navbar-link">Autori</a>
          <a th:href="@{/login}" class="navbar-link">Accedi</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="main-content">
    <div th:if="${books.empty}" class="empty-message">
      Nessun libro disponibile
    </div>

    <div th:unless="${books.empty}" class="books-grid">
      <div th:each="book : ${books}" class="book-card">
        <div class="book-cover-wrapper">
          <img th:if="${book.images != null and !book.images.empty}"
               th:src="${book.images[0].name}"
               th:alt="'Copertina di ' + ${book.title}" />
          <img th:unless="${book.images != null and !book.images.empty}"
               src="/images/placeholder.jpg"
               alt="Nessuna immagine disponibile" />
        </div>
        <div class="book-info">
          <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
          <a th:href="@{'/books/' + ${book.id}}"
             class="view-details-link">
            Dettagli
          </a>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>

</body>
</html>


--- resources/templates/error.html ---
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>Errore - Siwbooks</title>
    <style>
      body { font-family: sans-serif; margin: 2em; }
      h1 { color: #c00; }
      .details p { margin: 0.5em 0; }
    </style>
</head>
<body>
    <h1>Si è verificato un errore</h1>
    <div class="details">
      <p th:text="'Status: ' + ${status}">Status: ?</p>
      <p th:text="'Errore: ' + ${error}">Errore: ?</p>
      <p th:text="'Messaggio: ' + ${message}">Messaggio: ?</p>
      <p th:text="'Path: ' + ${path}">Path: ?</p>
      <p th:text="'Timestamp: ' + ${timestamp}">Timestamp: ?</p>
    </div>
    <p><a th:href="@{/}">← Torna alla pagina principale</a></p>
</body>
</html>


--- resources/templates/login.html ---
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/login.css}">
</head>
<body>

      <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/books}" class="navbar-link active">Libri</a>
          <a th:href="@{/authors}" class="navbar-link">Autori</a>
          <a th:href="@{/login}" class="navbar-link">Accedi</a>
        </div>
      </div>
    </nav>
  </header>

  <main class="login-wrapper">
    <div class="login-box">
      <h1>Accedi</h1>

      <form th:action="@{/login}" method="post">
        <div class="form-group">
          <label for="username">Username</label>
          <input id="username" name="username" />
        </div>

        <div class="form-group">
          <label for="pwd">Password</label>
          <input id="pwd" type="password" name="pwd" />
        </div>

        <button type="submit">Login</button>

        <div th:if="${param.error}" class="error-msg">
          Credenziali non valide
        </div>

        <p class="register-prompt">
          Non hai un account?
          <a href="/register" class="register-link">Registrati qui</a>
        </p>
      </form>
    </div>
  </main>

    <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>

  
</body>
</html>


--- resources/templates/register.html ---
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/register.css}">
</head>
<body>

    <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/books}" class="navbar-link active">Libri</a>
          <a th:href="@{/authors}" class="navbar-link">Autori</a>
          <a th:href="@{/login}" class="navbar-link">Accedi</a>
        </div>
      </div>
    </nav>
  </header>


<div class="register-wrapper">
  <div class="register-box">
    <h1>Registrati</h1>
    <form th:action="@{/register}" th:object="${credentials}" method="post">

      <div class="form-group">
        <label for="username">Username</label>
        <input id="username" th:field="*{username}" />
        <div th:if="${#fields.hasErrors('username')}"
             th:errors="*{username}"
             class="field-error">
        </div>
      </div>

      <div class="form-group">
        <label for="password">Password</label>
        <input id="password" type="password" th:field="*{password}" />
        <div th:if="${#fields.hasErrors('password')}"
             th:errors="*{password}"
             class="field-error">
        </div>
      </div>

      <div class="form-group">
        <label for="nome">Nome</label>
        <input id="nome" th:field="*{user.nome}" />
      </div>

      <div class="form-group">
        <label for="cognome">Cognome</label>
        <input id="cognome" th:field="*{user.cognome}" />
      </div>

      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" th:field="*{user.email}" />
      </div>

      <button type="submit">Registrati</button>

      <div th:if="${#fields.hasGlobalErrors()}"
           th:errors="*{__all__}"
           class="global-error"></div>
    </form>
  </div>
</div>


  <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>
  
</body>
</html>

--- resources/templates/review_edit.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Modifica recensione</title>
</head>
<body>

<h1>Modifica la tua recensione</h1>

<form th:action="@{/books/{bookId}/reviews/{reviewId}/edit(
                     bookId=${bookId},
                     reviewId=${editReview.id})}"
      th:object="${editReview}"
      method="post">

  <div>
    <label>Titolo:
      <input type="text" th:field="*{title}" />
    </label>
    <div th:if="${#fields.hasErrors('title')}" th:errors="*{title}"></div>
  </div>

  <div>
    <label>Testo:
      <textarea th:field="*{text}"></textarea>
    </label>
    <div th:if="${#fields.hasErrors('text')}" th:errors="*{text}"></div>
  </div>

  <div>
    <label>Voto:
      <input type="number" min="1" max="5" th:field="*{mark}" />
    </label>
    <div th:if="${#fields.hasErrors('mark')}" th:errors="*{mark}"></div>
  </div>

  <button type="submit">Aggiorna</button>
  <a th:href="@{'/books/' + ${bookId}}">Annulla</a>
</form>

</body>
</html>


--- resources/templates/user/author.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/author.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">

</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/user/books}" class="navbar-link">Libri</a>
          <a th:href="@{/user/authors}" class="navbar-link active">Autori</a>
          <a th:href="@{'/user/' + ${user.id}}" class="navbar-link">Profilo</a>
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

    <main class="main-content">
      <div class="author-card">
        <img th:if="${author.photo==null}"
             src="/images/placeholder.jpg" 
             alt="Nessuna foto autore">
        <img th:unless="${author.photo==null}"
             th:src="${author.photo.name}" 
             th:alt="'Foto di ' + ${author.getFullName()}">
        <div th:text="'Nome: ' + ${author.name}"></div>
        <div th:text="'Cognome: ' + ${author.surname}"></div>
        <div th:text="'Nato il: ' + ${author.birthDate}"></div>
        <div th:if="${author.deathDate!=null}" th:text="'Morto il: ' + ${author.deathDate}"></div>
        <div th:text="'Nazionalità: ' + ${#strings.capitalize(#strings.toLowerCase(author.nationality))}"></div>
      </div>

      <div th:if="${author.books != null and !author.books.empty}">
          <div th:if="${author.books.empty}" class="empty-message">
            Nessun libro disponibile
          </div>

          <div th:unless="${author.books.empty}" class="books-grid">
            <div th:each="book : ${author.books}" class="book-card">
              <div class="book-cover-wrapper">
                <img th:if="${book.images != null and !book.images.empty}"
                    th:src="${book.images[0].name}"
                    th:alt="'Copertina di ' + ${book.title}" />
                <img th:unless="${book.images != null and !book.images.empty}"
                    src="/images/placeholder.jpg"
                    alt="Nessuna immagine disponibile" />
              </div>
              <div class="book-info">
                <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
              </div>
            </div>
          </div>

        </div>
      </div>
    </main>


    <footer class="footer">
    <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
    </div>
	</footer>

</body>
</html>

--- resources/templates/user/authors.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/authors.css}">
    <link rel="stylesheet" th:href="@{/css/layout.css}">

</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/user/books}" class="navbar-link">Libri</a>
          <a th:href="@{/user/authors}" class="navbar-link active">Autori</a>
          <a th:href="@{'/user/' + ${user.id}}" class="navbar-link">Profilo</a>
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

    <main class="main-content">
    <div th:if="${authors.empty}" class="no-content"> 
        Nessun autore disponibile
    </div>
    <div th:unless="${authors.empty}" 
        class="authors-grid">
        <div th:each="author : ${authors}"
            class="author-card">
        <img th:if="${author.photo == null}"
            src="/images/placeholder.jpg"
            alt="Nessuna immagine autore"/>
        <img th:if="${author.photo != null}"
            th:src="${author.photo.name}"
            alt="Immagine autore"/>
        <div class="author-info">
            <h2 th:text="${author.getFullName()}">Full Name</h2>
            <a th:href="@{'/user/authors/' + ${author.id}}"
            class="view-details-link">Dettagli</a>
        </div>
        </div>
    </div>
    </main>


    <footer class="footer">
    <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
    </div>
	</footer>

</body>
</html>

--- resources/templates/user/book.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/css/book.css}" />
    <link rel="stylesheet" th:href="@{/css/layout.css}" />
  </head>

  <body>
  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/user/books}" class="navbar-link active">Libri</a>
          <a th:href="@{/user/authors}" class="navbar-link">Autori</a>
          <a th:href="@{'/user/' + ${user.id}}" class="navbar-link">Profilo</a>
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

    <main class="details-container">
      <div class="book-details">
        <!-- Section IMAGES ORIZZONTALI -->
        <div class="images-container">
          <div class="images-grid" th:if="${not #lists.isEmpty(book.images)}">
            <div th:each="img : ${book.images}" class="image-item">
              <img
                th:src="@{${img.name}}"
                class="book-img"
                th:alt="'Immagine del libro ' + ${book.title}"
              />
            </div>
          </div>
          <!-- Placeholder for no images -->
          <div
            th:if="${#lists.isEmpty(book.images)}"
            class="no-images-placeholder"
          >
            Nessuna immagine disponibile
          </div>
        </div>
        <!-- Book Information Section -->
        <div class="book-info">
          <h1 class="book-title" th:text="${book.title}">Titolo del Libro</h1>
          <!-- Authors Section -->
          <div class="info-section">
            <h2>Autori</h2>
            <div class="authors-list">
              <a
                th:each="author : ${book.authors}"
                th:href="@{'/user/authors/' + ${author.id}}"
                class="author-link"
                th:text="${author.name + ' ' + author.surname}"
              >
                Nome Autore
              </a>
            </div>
          </div>
          <!-- Publication Year Section -->
          <div class="info-section">
            <h2>Anno di Pubblicazione</h2>
            <p th:text="${book.publicationYear}">2023</p>
          </div>
        </div>
      </div>
        <!-- Reviews Section -->
        <div class="info-section">
          <h2>Recensioni</h2>
          <!-- Reviews List -->
          <div class="reviews-list" th:if="${not #lists.isEmpty(book.reviews)}">
            <div th:each="review : ${book.reviews}" class="review-item">
              <h4
                class="review-title"
                th:text="'Titolo: ' + ${review.title} + ' [ ' + ${review.user.nome} + ' ' + ${review.user.cognome} + ' ]'"
              >
                Titolo recensione
              </h4>
              <p class="review-text">Testo:</p>
              <p class="review-text" th:text="${review.text}">
                Testo della recensione
              </p>
              <p
                class="review-rating"
                th:text="${'Valutazione: ' + review.mark + '/5'}"
              >
                Valutazione: 5/5
              </p>
            </div>
          </div>
          <!-- No Reviews Message -->
          <div class="reviews-list" th:if="${#lists.isEmpty(book.reviews)}">
            <h3 class="review-empty">Nessuna recensione</h3>
          </div>

        <div th:unless="${hasReview}">
          <form th:action="@{'/user/' + ${user.id} + '/books/' + ${book.id} + '/review'}"
                method="post"
                class="review-form">
            <!-- CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <input type="text" name="title" placeholder="Titolo" required>
            <textarea name="text" placeholder="Testo della recensione" required></textarea>
            <select name="mark" required>
              <option value="" disabled selected>Valutazione</option>
              <option th:each = "i : ${#numbers.sequence(1,5)}"
                      th:value="${i}" th:text="${i}">1</option>
            </select>
            <button type="submit">Invia Recensione</button>
          </form>
        </div>

        <div th:if="${hasReview}" class="already-reviewed">
          Hai già commentato!
        </div>

        </div>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <p>Siwbooks - La tua libreria digitale</p>
      </div>
    </footer>
  </body>
</html>


--- resources/templates/user/books.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/books.css}">
</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/user/books}" class="navbar-link active">Libri</a>
          <a th:href="@{/user/authors}" class="navbar-link">Autori</a>
          <a th:href="@{'/user/' + ${user.id}}" class="navbar-link">Profilo</a>
          <form th:action="@{/logout}" method="post">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

  <main class="main-content">
    <div th:if="${books.empty}" class="empty-message">
      Nessun libro disponibile
    </div>

    <div th:unless="${books.empty}" class="books-grid">
      <div th:each="book : ${books}" class="book-card">
        <div class="book-cover-wrapper">
          <img th:if="${book.images != null and !book.images.empty}"
               th:src="${book.images[0].name}"
               th:alt="'Copertina di ' + ${book.title}" />
          <img th:unless="${book.images != null and !book.images.empty}"
               src="/images/placeholder.jpg"
               alt="Nessuna immagine disponibile" />
        </div>
        <div class="book-info">
          <h2 class="book-title" th:text="${book.title}">Titolo libro</h2>
          <a th:href="@{'/user/books/' + ${book.id}}"
             class="view-details-link">
            Dettagli
          </a>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>

</body>
</html>


--- resources/templates/user/profile.html ---
<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Catalogo Libri</title>
  <link rel="stylesheet" th:href="@{/css/layout.css}">
  <link rel="stylesheet" th:href="@{/css/profile.css}">
</head>
<body>

  <header class="header">
    <nav class="navbar">
      <div class="navbar-content">
        <div class="navbar-links-group">
          <h1 class="navbar-Title">SiwBooks</h1>
        </div>
        <div class="navbar-links-group">
          <a th:href="@{/}" class="navbar-link">Home</a>
          <a th:href="@{/user/books}" class="navbar-link">Libri</a>
          <a th:href="@{/user/authors}" class="navbar-link">Autori</a>
          <a th:href="@{'/user/' + ${user.id}}" class="navbar-link active">Profilo</a>
          <form th:action="@{/logout}" method="post" style="display:inline">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
            <button type="submit" class="navbar-link">Esci</button>
          </form>


        </div>
      </div>
    </nav>
  </header>

  <div class="profile-wrapper">
    <div class="profile-box">
      <h1 th:text="'Bentornato ' + ${user.nome}">Bentornato Mario</h1>
      <p><strong>Nome:</strong> <span th:text="${user.nome}">Mario</span></p>
      <p><strong>Cognome:</strong> <span th:text="${user.cognome}">Rossi</span></p>
      <p><strong>Email:</strong> <span th:text="${user.email}">example@gmail.com</span></p>
    </div>
  </div>

  <footer class="footer">
    <div class="footer-content">
      <p>Siwbooks - La tua libreria digitale</p>
    </div>
  </footer>


</body>
</html>

